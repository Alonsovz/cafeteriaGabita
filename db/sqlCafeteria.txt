DROP DATABASE cafeteriaGabita;

create database cafeteriaGabita;

use cafeteriaGabita;

create table rol(
codigoRol int primary key  auto_increment,
descRol varchar(50)
);

create table usuario (
    codigoUsuario int primary key  auto_increment,
    nombre varchar(50),
    apellido varchar(50),
    nomUsuario varchar(75),
    email varchar(100),
    pass varchar(75),
    telefono varchar(50),
    codigoRol int,
    idEliminado int
);



ALTER TABLE usuario
ADD FOREIGN KEY (codigoRol) REFERENCES  rol(codigoRol);



insert into rol values(1,'Administrador');
insert into rol values(2,'Cajero');


insert into usuario values(1,'Fabio','Mejia','fabio','mejiafabio383@gmail.com','40bd001563085fc35165329ea1ff5c5ecbdbbeef','7258-8312',1,1);



delimiter $$

create procedure login(
	
in user varchar(50),
    
in contra varchar(75)

)

begin
	
select u.*, r.descRol

	from usuario u
	
inner join rol r on r.codigoRol = u.codigoRol

where u.nomUsuario = user and u.pass = contra and u.idEliminado=1;

end	

$$




delimiter $$

create procedure mostrarUsuarios()

begin
	
select u.*, r.descRol

from usuario u
	
inner join rol r on r.codigoRol = u.codigoRol

where u.idEliminado=1 and u.codigoUsuario>1;

end

$$




create table sucursales(
id int primary key  auto_increment,
nombre varchar(100),
idEliminado int   
);


create table areas(
id int primary key  auto_increment,
nombre varchar(100),
idSucursal int,
cantidadSubsidio double,
idEliminado int   
);


ALTER TABLE areas
ADD FOREIGN KEY (idSucursal) REFERENCES  sucursales(id);


create table cajas(
id int primary key  auto_increment,
nombre varchar(100),
idSucursal int,
idEliminado int    
);


ALTER TABLE cajas
ADD FOREIGN KEY (idSucursal) REFERENCES  sucursales(id);


create table clientes(
id int primary key  auto_increment,
nombre varchar(100),
carnet varchar(100),
idArea int,
idEliminado int    
);


ALTER TABLE clientes
ADD FOREIGN KEY (idArea) REFERENCES  areas(id);



create table productos(
id int primary key  auto_increment,
codigo varchar(100),
nombre varchar(100),
idSucursal int,
precio double,
idEliminado int   
);


ALTER TABLE productos
ADD FOREIGN KEY (idSucursal) REFERENCES  sucursales(id);